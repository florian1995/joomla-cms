SELECT m.type_alias, m.content_item_id, m.core_content_id, count(m.tag_id) AS match_count,
MAX(m.tag_date) as tag_date, MAX(c.core_title) AS core_title, MAX(c.core_params) AS core_params,
MAX(c.core_alias) AS core_alias, MAX(c.core_body) AS core_body, MAX(c.core_state) AS core_state,
MAX(c.core_access) AS core_access,MAX(c.core_metadata) AS core_metadata, MAX(c.core_created_user_id) AS core_created_user_id,
MAX(c.core_created_by_alias) AS core_created_by_alias,MAX(c.core_created_time) as core_created_time, MAX(c.core_images) as core_images,
CASE WHEN c.core_modified_time = '0000-00-00 00:00:00' THEN c.core_created_time ELSE c.core_modified_time END as core_modified_time,
MAX(c.core_language) AS core_language, MAX(c.core_catid) AS core_catid,MAX(c.core_publish_up) AS core_publish_up,
MAX(c.core_publish_down) as core_publish_down,MAX(ct.type_title) AS content_type_title, MAX(ct.router) AS router,
CASE WHEN c.core_created_by_alias > ' ' THEN c.core_created_by_alias ELSE ua.name END AS author,ua.email AS author_email, ctnt.attribs
FROM p5o97_contentitem_tag_map AS m
INNER JOIN p5o97_ucm_content AS c ON m.type_alias = c.core_type_alias AND m.core_content_id = c.core_content_id AND c.core_state IN (1) AND (c.core_publish_up = '0000-00-00 00:00:00' OR c.core_publish_up <= '2016-08-08 11:48:09')  AND (c.core_publish_down = '0000-00-00 00:00:00' OR  c.core_publish_down >= '2016-08-08 11:48:09')
INNER JOIN p5o97_content_types AS ct ON ct.type_alias = m.type_alias
INNER JOIN p5o97_categories AS tc ON tc.id = c.core_catid AND tc.published = 1
LEFT JOIN p5o97_users AS ua ON ua.id = c.core_created_user_id
LEFT JOIN p5o97_content AS ctnt on ctnt.id=m.content_item_id AND m.type_alias = 'com_content.article'
WHERE m.tag_id IN (2) AND m.type_alias IN ('com_content.article','com_contact.contact','com_newsfeeds.newsfeed','com_users.user','com_content.category','com_contact.category','com_newsfeeds.category','com_tags.tag','com_banners.banner','com_banners.category','com_banners.client','com_users.note','com_users.category') AND c.core_access IN (0,1)
GROUP BY m.type_alias, m.content_item_id, m.core_content_id, core_modified_time, core_created_time, core_created_by_alias, name, author_email
ORDER BY MAX(`c`.`core_title`) ASC;